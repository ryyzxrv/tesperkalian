<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tes Perkalian 5B</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5f7fa;
            --accent-color: #50c878;
            --danger-color: #e74c3c;
            --text-color: #2c3e50;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: white;
            width: 90%;
            max-width: 800px;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        h1, h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }

        /* Forms & Inputs */
        input, select {
            padding: 10px;
            margin: 10px 0;
            width: 80%;
            max-width: 300px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        button {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: bold;
            transition: 0.3s;
            margin: 5px;
        }

        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: #357abd; }
        
        .btn-success { background-color: var(--accent-color); color: white; }
        .btn-danger { background-color: var(--danger-color); color: white; }
        .btn-secondary { background-color: #95a5a6; color: white; }

        /* Utility Classes */
        .hidden { display: none !important; }
        .card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        /* Login Tabs */
        .login-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        .tab-btn {
            background: none;
            color: #aaa;
            padding: 10px 20px;
            border-radius: 0;
        }
        .tab-btn.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }
        th { background-color: var(--primary-color); color: white; }
        tr:hover { background-color: #f1f1f1; }

        /* Grid for selection */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        .level-btn {
            background-color: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 15px;
        }
        .level-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Timer */
        #timer-display {
            font-size: 1.5rem;
            color: var(--danger-color);
            font-weight: bold;
            margin: 10px 0;
        }

        .toast {
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="toast-msg" class="toast"></div>

    <header>
        <h1>Kelas 5B: Tes Perkalian</h1>
    </header>

    <div id="login-section">
        <div class="login-tabs">
            <button class="tab-btn active" onclick="switchTab('student')">Murid</button>
            <button class="tab-btn" onclick="switchTab('admin')">Admin (Guru)</button>
        </div>

        <div id="student-login-form">
            <h3>Login Murid</h3>
            <p>Silakan masuk menggunakan nama yang didaftarkan guru.</p>
            <input type="text" id="std-username" placeholder="Nama Pengguna (Username)">
            <input type="password" id="std-password" placeholder="Kata Sandi">
            <br>
            <button class="btn-primary" onclick="loginStudent()">Masuk</button>
        </div>

        <div id="admin-login-form" class="hidden">
            <h3>Login Guru</h3>
            <p>Khusus Pak Tanjung</p>
            <input type="text" id="adm-username" placeholder="Username">
            <input type="password" id="adm-password" placeholder="Password">
            <br>
            <button class="btn-primary" onclick="loginAdmin()">Masuk Admin</button>
        </div>
    </div>

    <div id="student-dashboard" class="hidden">
        <h2 id="welcome-student">Halo, Murid!</h2>
        <p>Pilih perkalian yang ingin kamu kerjakan:</p>
        <div class="grid-container" id="level-grid">
            </div>
        <br>
        <button class="btn-danger" onclick="logout()">Keluar</button>
    </div>

    <div id="quiz-section" class="hidden">
        <h2>Tes Perkalian <span id="quiz-level-title"></span></h2>
        <div id="timer-display">Waktu: 60s</div>
        
        <div class="card">
            <h3 style="font-size: 2.5rem; margin: 20px 0;" id="question-text">5 x 5 = ?</h3>
            <input type="number" id="quiz-answer" placeholder="Jawaban..." onkeydown="if(event.key==='Enter') submitAnswer()">
            <br>
            <button class="btn-success" onclick="submitAnswer()">Jawab</button>
        </div>
        <p>Soal <span id="current-q-num">1</span> dari 10</p>
    </div>

    <div id="admin-dashboard" class="hidden">
        <h2>Panel Guru (Pak Tanjung)</h2>
        <div style="text-align: left; margin-bottom: 20px;">
            <button class="btn-secondary" onclick="logout()">Keluar</button>
        </div>

        <div style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
            <div class="card" style="flex: 1; min-width: 300px;">
                <h3>Tambah Akun Murid</h3>
                <input type="text" id="new-std-name" placeholder="Nama Lengkap">
                <input type="text" id="new-std-user" placeholder="Username (untuk login)">
                <input type="text" id="new-std-pass" placeholder="Password">
                <br>
                <button class="btn-primary" onclick="registerStudent()">Buat Akun</button>
            </div>

            <div class="card" style="flex: 2; min-width: 300px;">
                <h3>Analisis Hasil Tes</h3>
                <div style="overflow-x: auto;">
                    <table id="results-table">
                        <thead>
                            <tr>
                                <th>Nama</th>
                                <th>Perkalian</th>
                                <th>Nilai</th>
                                <th>Tanggal</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
                <button class="btn-danger" style="margin-top:10px; font-size: 0.8rem;" onclick="clearAllData()">Hapus Semua Data (Reset)</button>
            </div>
        </div>
    </div>

</div>

<script>
    // --- DATA MANAGEMENT (Local Storage) ---
    const DB_USERS = 'db_users_5b';
    const DB_RESULTS = 'db_results_5b';

    function getData(key) {
        return JSON.parse(localStorage.getItem(key)) || [];
    }

    function saveData(key, data) {
        localStorage.setItem(key, JSON.stringify(data));
    }

    // --- STATE VARIABLES ---
    let currentUser = null;
    let currentLevel = 1;
    let currentQuestionIndex = 0;
    let score = 0;
    let timerInterval;
    let timeLeft = 60;
    let questions = [];

    // --- INITIALIZATION ---
    window.onload = function() {
        generateLevelButtons();
        // Initialize empty if not exists
        if (!localStorage.getItem(DB_USERS)) saveData(DB_USERS, []);
        if (!localStorage.getItem(DB_RESULTS)) saveData(DB_RESULTS, []);
    };

    // --- NAVIGATION ---
    function showSection(id) {
        document.querySelectorAll('.container > div').forEach(div => {
            if(div.id !== 'toast-msg') div.classList.add('hidden');
        });
        document.querySelector('header').classList.remove('hidden');
        document.getElementById(id).classList.remove('hidden');
    }

    function switchTab(role) {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        if (role === 'student') {
            document.querySelectorAll('.tab-btn')[0].classList.add('active');
            document.getElementById('student-login-form').classList.remove('hidden');
            document.getElementById('admin-login-form').classList.add('hidden');
        } else {
            document.querySelectorAll('.tab-btn')[1].classList.add('active');
            document.getElementById('student-login-form').classList.add('hidden');
            document.getElementById('admin-login-form').classList.remove('hidden');
        }
    }

    function showToast(msg) {
        const toast = document.getElementById('toast-msg');
        toast.innerText = msg;
        toast.style.display = 'block';
        setTimeout(() => toast.style.display = 'none', 3000);
    }

    // --- AUTHENTICATION ---
    function loginAdmin() {
        const u = document.getElementById('adm-username').value;
        const p = document.getElementById('adm-password').value;

        if (u === 'Pak Tanjung' && p === 'guru') {
            showSection('admin-dashboard');
            loadAdminData();
            document.getElementById('adm-username').value = '';
            document.getElementById('adm-password').value = '';
        } else {
            alert('Username atau Password Guru salah!');
        }
    }

    function loginStudent() {
        const u = document.getElementById('std-username').value;
        const p = document.getElementById('std-password').value;
        const users = getData(DB_USERS);

        const found = users.find(user => user.username === u && user.password === p);

        if (found) {
            currentUser = found;
            document.getElementById('welcome-student').innerText = `Halo, ${found.name}!`;
            showSection('student-dashboard');
            document.getElementById('std-username').value = '';
            document.getElementById('std-password').value = '';
        } else {
            alert('Akun tidak ditemukan. Minta Pak Tanjung untuk membuatkan akun.');
        }
    }

    function logout() {
        currentUser = null;
        clearInterval(timerInterval);
        showSection('login-section');
    }

    // --- ADMIN FUNCTIONS ---
    function registerStudent() {
        const name = document.getElementById('new-std-name').value;
        const user = document.getElementById('new-std-user').value;
        const pass = document.getElementById('new-std-pass').value;

        if (!name || !user || !pass) {
            alert('Semua kolom harus diisi!');
            return;
        }

        const users = getData(DB_USERS);
        if (users.find(u => u.username === user)) {
            alert('Username sudah dipakai!');
            return;
        }

        users.push({ name: name, username: user, password: pass });
        saveData(DB_USERS, users);
        showToast('Murid berhasil ditambahkan!');
        
        // Clear inputs
        document.getElementById('new-std-name').value = '';
        document.getElementById('new-std-user').value = '';
        document.getElementById('new-std-pass').value = '';
    }

    function loadAdminData() {
        const results = getData(DB_RESULTS);
        const tbody = document.querySelector('#results-table tbody');
        tbody.innerHTML = '';

        // Sort by newest
        results.reverse().forEach(r => {
            const row = `<tr>
                <td>${r.name}</td>
                <td>Perkalian ${r.level}</td>
                <td><strong>${r.score}</strong></td>
                <td>${r.date}</td>
            </tr>`;
            tbody.innerHTML += row;
        });

        if(results.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Belum ada data tes.</td></tr>';
        }
    }

    function clearAllData() {
        if(confirm("Apakah Anda yakin ingin menghapus semua data murid dan hasil tes? Tindakan ini tidak bisa dibatalkan.")) {
            localStorage.clear();
            location.reload();
        }
    }

    // --- QUIZ LOGIC ---
    function generateLevelButtons() {
        const grid = document.getElementById('level-grid');
        for (let i = 1; i <= 20; i++) {
            const btn = document.createElement('button');
            btn.className = 'level-btn';
            btn.innerText = `x ${i}`;
            btn.onclick = () => startQuiz(i);
            grid.appendChild(btn);
        }
    }

    function startQuiz(level) {
        currentLevel = level;
        currentQuestionIndex = 0;
        score = 0;
        questions = [];

        // Generate 10 Random Questions for the selected level
        // Standard multiplication usually goes x1 to x10
        for(let i=0; i<10; i++) {
            const multiplier = Math.floor(Math.random() * 10) + 1; // 1 to 10
            questions.push({
                q: `${level} x ${multiplier}`,
                a: level * multiplier
            });
        }

        showSection('quiz-section');
        document.getElementById('quiz-level-title').innerText = level;
        loadQuestion();
    }

    function loadQuestion() {
        if (currentQuestionIndex >= 10) {
            finishQuiz();
            return;
        }

        const q = questions[currentQuestionIndex];
        document.getElementById('question-text').innerText = `${q.q} = ?`;
        document.getElementById('current-q-num').innerText = currentQuestionIndex + 1;
        document.getElementById('quiz-answer').value = '';
        document.getElementById('quiz-answer').focus();

        // Reset Timer
        clearInterval(timerInterval);
        timeLeft = 60;
        updateTimerDisplay();
        timerInterval = setInterval(() => {
            timeLeft--;
            updateTimerDisplay();
            if (timeLeft <= 0) {
                submitAnswer(true); // Force submit as wrong/timeout
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        const timerEl = document.getElementById('timer-display');
        timerEl.innerText = `Waktu: ${timeLeft}s`;
        if(timeLeft < 10) timerEl.style.color = 'red';
        else timerEl.style.color = '#e74c3c';
    }

    function submitAnswer(isTimeout = false) {
        clearInterval(timerInterval);
        
        if (!isTimeout) {
            const userAnswer = parseInt(document.getElementById('quiz-answer').value);
            const correctAnswer = questions[currentQuestionIndex].a;

            if (userAnswer === correctAnswer) {
                score += 10;
                showToast("Benar! ðŸ‘");
            } else {
                showToast(`Salah! Jawabannya ${correctAnswer}`);
            }
        } else {
            showToast("Waktu Habis!");
        }

        currentQuestionIndex++;
        // Small delay to read feedback
        setTimeout(() => {
            loadQuestion();
        }, 1000);
    }

    function finishQuiz() {
        clearInterval(timerInterval);
        
        // Save Result
        const results = getData(DB_RESULTS);
        const now = new Date();
        const dateString = now.toLocaleDateString('id-ID') + ' ' + now.toLocaleTimeString('id-ID');

        results.push({
            name: currentUser.name,
            level: currentLevel,
            score: score,
            date: dateString
        });
        saveData(DB_RESULTS, results);

        alert(`Tes Selesai!\nNilai Kamu: ${score}`);
        showSection('student-dashboard');
    }

</script>

</body>
</html>
